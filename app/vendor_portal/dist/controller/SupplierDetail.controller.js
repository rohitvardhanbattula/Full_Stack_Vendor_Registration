sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,n,s){"use strict";return e.extend("vendorportal.controller.SupplierDetail",{formatMimeType:function(e){if(!e){return""}switch(e.toLowerCase()){case"application/pdf":return"PDF";case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"XLSX";case"application/vnd.ms-excel":return"XLS";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"DOCX";case"application/msword":return"DOC";case"image/png":return"PNG";case"image/jpeg":return"JPEG";case"image/jpg":return"JPG";default:const t=e.split("/");return t.length>1?t[1].toUpperCase():e.toUpperCase()}},onInit:function(){this.getView().setModel(new n({attachments:[]}),"attachmentsModel");this.getView().setModel(new n({status:[]}),"statusModel");this.getView().setModel(new n({gstChecks:[]}),"gstValidationModel");const e=this.getOwnerComponent().getRouter();e.getRoute("SupplierDetail").attachPatternMatched(this._onObjectMatched,this)},onDownloadAttachment:function(e){const t=e.getSource().getBindingContext("attachmentsModel").getObject();if(!t||!t.fileName){s.warning("File information missing.");return}const n=this._base64ToBlob(t.content,t.mimeType);const o=document.createElement("a");o.href=URL.createObjectURL(n);o.download=t.fileName;o.click();URL.revokeObjectURL(o.href)},onNavBack:function(){const e=t.getInstance();const n=e.getPreviousHash();if(n!==undefined){window.history.go(-1)}else{const e=this.getOwnerComponent().getRouter();e.navTo("SupplierList",{},true)}},_onObjectMatched:function(e){const t=this.getView();const s=e.getParameter("arguments").supplierId;t.setModel(new n({}));t.getModel("attachmentsModel").setProperty("/attachments",[]);t.getModel("statusModel").setProperty("/status",[]);t.getModel("gstValidationModel").setProperty("/gstChecks",[]);t.setBusy(true);const o=this._fetchSupplierDetails(s);const r=this._fetchApprovals(s);const a=this._fetchAttachments(s);const i=this._fetchGstDetails(s);Promise.all([o,r,a,i]).finally(()=>{t.setBusy(false)})},_fetchGstDetails:function(e){const t=this.getURL()+`/odata/v4/supplier/gst?$filter=supplierName eq '${encodeURIComponent(e)}'`;return fetch(t).then(e=>{if(!e.ok){throw new Error("Failed to fetch GST details.")}return e.json()}).then(e=>{const t=e.value||[];this.getView().getModel("gstValidationModel").setProperty("/gstChecks",t)}).catch(e=>{console.error("Error fetching GST details:",e.message)})},_fetchSupplierDetails:function(e){return fetch(this.getURL()+`/odata/v4/supplier/getsuppliers`).then(e=>e.json()).then(t=>{const o=Array.isArray(t.value)?t.value:[];const r=o.find(t=>t.supplierName===e);if(r){this.getView().setModel(new n(r));this.getView().bindElement("/")}else{s.error("Supplier not found: "+e)}}).catch(e=>{s.error("Error fetching supplier details: "+e.message)})},_fetchApprovals:function(e){return fetch(this.getURL()+`/odata/v4/supplier/Approvals?suppliername=${e}`).then(e=>e.json()).then(e=>{const t=e.value||[];this.getView().getModel("statusModel").setProperty("/status",t)}).catch(e=>{s.error("Error fetching approvals: "+e.message)})},_fetchAttachments:function(e){return fetch(this.getURL()+`/odata/v4/supplier/downloadAttachments(supplierName='${encodeURIComponent(e)}')`).then(e=>e.json()).then(e=>{const t=Array.isArray(e)?e:e.value||[];this.getView().getModel("attachmentsModel").setProperty("/attachments",t)}).catch(e=>{s.error("Error loading attachments: "+e.message)})},_base64ToBlob:function(e,t){t=t||"";const n=512;const s=atob(e);const o=[];for(let e=0;e<s.length;e+=n){const t=s.slice(e,e+n);const r=new Array(t.length);for(let e=0;e<t.length;e++){r[e]=t.charCodeAt(e)}o.push(new Uint8Array(r))}return new Blob(o,{type:t})},getURL:function(){return sap.ui.require.toUrl("vendorportal")}})});
//# sourceMappingURL=SupplierDetail.controller.js.map