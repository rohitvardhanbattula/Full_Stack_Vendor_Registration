sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,n,o){"use strict";return e.extend("vendorportal.controller.SupplierDetail",{formatMimeType:function(e){if(!e){return""}switch(e.toLowerCase()){case"application/pdf":return"PDF";case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"XLSX";case"application/vnd.ms-excel":return"XLS";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"DOCX";case"application/msword":return"DOC";case"image/png":return"PNG";case"image/jpeg":return"JPEG";case"image/jpg":return"JPG";default:const t=e.split("/");return t.length>1?t[1].toUpperCase():e.toUpperCase()}},onInit:function(){this.getView().setModel(new n({attachments:[]}),"attachmentsModel");this.getView().setModel(new n({status:[]}),"statusModel");const e=this.getOwnerComponent().getRouter();e.getRoute("SupplierDetail").attachPatternMatched(this._onObjectMatched,this)},onDownloadAttachment:function(e){const t=e.getSource().getBindingContext("attachmentsModel").getObject();if(!t||!t.fileName){o.warning("File information missing.");return}const n=this._base64ToBlob(t.content,t.mimeType);const s=document.createElement("a");s.href=URL.createObjectURL(n);s.download=t.fileName;s.click();URL.revokeObjectURL(s.href)},onNavBack:function(){const e=t.getInstance();const n=e.getPreviousHash();if(n!==undefined){window.history.go(-1)}else{const e=this.getOwnerComponent().getRouter();e.navTo("SupplierList",{},true)}},_onObjectMatched:function(e){const t=this.getView();const o=e.getParameter("arguments").supplierId;t.setModel(new n({}));t.getModel("attachmentsModel").setProperty("/attachments",[]);t.getModel("statusModel").setProperty("/status",[]);t.setBusy(true);const s=this._fetchSupplierDetails(o);const r=this._fetchApprovals(o);const a=this._fetchAttachments(o);Promise.all([s,r,a]).finally(()=>{t.setBusy(false)})},_fetchSupplierDetails:function(e){return fetch(this.getURL()+`/odata/v4/supplier/getsuppliers`).then(e=>e.json()).then(t=>{const s=Array.isArray(t.value)?t.value:[];const r=s.find(t=>t.supplierName===e);if(r){this.getView().setModel(new n(r));this.getView().bindElement("/")}else{o.error("Supplier not found: "+e)}}).catch(e=>{o.error("Error fetching supplier details: "+e.message)})},_fetchApprovals:function(e){return fetch(this.getURL()+`/odata/v4/supplier/Approvals?suppliername=${e}`).then(e=>e.json()).then(e=>{const t=e.value||[];this.getView().getModel("statusModel").setProperty("/status",t)}).catch(e=>{o.error("Error fetching approvals: "+e.message)})},_fetchAttachments:function(e){return fetch(this.getURL()+`/odata/v4/supplier/downloadAttachments(supplierName='${encodeURIComponent(e)}')`).then(e=>e.json()).then(e=>{const t=Array.isArray(e)?e:e.value||[];this.getView().getModel("attachmentsModel").setProperty("/attachments",t)}).catch(e=>{o.error("Error loading attachments: "+e.message)})},_base64ToBlob:function(e,t){t=t||"";const n=512;const o=atob(e);const s=[];for(let e=0;e<o.length;e+=n){const t=o.slice(e,e+n);const r=new Array(t.length);for(let e=0;e<t.length;e++){r[e]=t.charCodeAt(e)}s.push(new Uint8Array(r))}return new Blob(s,{type:t})},getURL:function(){return sap.ui.require.toUrl("vendorportal")}})});
//# sourceMappingURL=SupplierDetail.controller.js.map