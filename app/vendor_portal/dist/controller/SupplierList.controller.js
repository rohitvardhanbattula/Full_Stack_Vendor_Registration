sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,s,n,i){"use strict";return e.extend("vendorportal.controller.SupplierList",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("SupplierList").attachPatternMatched(this._onRouteMatched,this);this._refreshInterval=null},onExit:function(){if(this._refreshInterval){clearInterval(this._refreshInterval)}},onSupplierPress:function(e){const t=e.getParameter("listItem");const s=t.getBindingContext();const n=s.getObject();const i=n.supplierName;const r=this.getOwnerComponent().getRouter();r.navTo("SupplierDetail",{supplierId:i})},onDeleteMode:function(){const e=this.byId("supplierTable");e.setMode("MultiSelect");this.byId("deleteModeButton").setVisible(false);this.byId("confirmDeleteButton").setVisible(true);this.byId("cancelDeleteButton").setVisible(true)},onCancelDelete:function(){const e=this.byId("supplierTable");e.setMode("None");e.removeSelections(true);this.byId("deleteModeButton").setVisible(true);this.byId("confirmDeleteButton").setVisible(false);this.byId("cancelDeleteButton").setVisible(false)},onDeleteSelectedSuppliers:function(){const e=this.byId("supplierTable");const t=e.getSelectedItems();if(t.length===0){s.warning("Please select at least one supplier to delete.");return}const n=`Are you sure you want to delete these ${t.length} supplier(s)?`;s.confirm(n,{title:"Confirm Deletion",onClose:e=>{if(e===s.Action.OK){this._performDeletion(t)}}})},_performDeletion:function(e){const t=this.getURL()+"/odata/v4/supplier/deletesuppliers";const n=e.map(e=>{const s=e.getBindingContext();const n=s.getProperty("supplierName");return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({supplierName:n})})});Promise.all(n).then(e=>{const t=e.filter(e=>!e.ok);if(t.length>0){s.error(`${t.length} deletion(s) failed. Please check the logs and refresh the list.`)}else{s.success(`${e.length} supplier(s) deleted successfully.`)}}).catch(e=>{s.error("An error occurred during deletion: "+e.message)}).finally(()=>{this.onCancelDelete();this._fetchSuppliers()})},onFilterSuppliers:function(){const e=this.byId("supplierTable");const t=e.getBinding("items");const s=this.byId("filterName").getValue();const r=this.byId("filterCity").getValue();const o=this.byId("filterStatus").getSelectedKey();const l=[];if(s){l.push(new n("supplierName",i.Contains,s))}if(r){l.push(new n("mainAddress/city",i.Contains,r))}if(o){l.push(new n("status",i.EQ,o))}t.filter(l)},onClearFilters:function(){this.byId("filterName").setValue("");this.byId("filterCity").setValue("");this.byId("filterStatus").setSelectedKey("");this.onFilterSuppliers()},onNavBack:function(){const e=sap.ui.core.routing.History.getInstance();const t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getOwnerComponent().getRouter().navTo("View1",{},true)}},formatStatusType:function(e){if(!e){return"Transparent"}e=e.toUpperCase();switch(e){case"APPROVED":return"Accept";case"REJECTED":return"Reject";case"PENDING":return"Attention";default:return"Transparent"}},_onRouteMatched:function(){this._fetchSuppliers();if(this._refreshInterval){clearInterval(this._refreshInterval)}this._refreshInterval=setInterval(()=>{this._fetchSuppliers()},15e3)},_fetchSuppliers:function(){fetch(this.getURL()+"/odata/v4/supplier/getsuppliers").then(e=>e.json()).then(e=>{const s=Array.isArray(e.value)?e.value:e;this.getView().setModel(new t({suppliers:s}));this.byId("deleteModeButton").setVisible(s&&s.length>0)}).catch(e=>{s.error("Error fetching suppliers: "+e.message)})},getURL:function(){return sap.ui.require.toUrl("vendorportal")}})});
//# sourceMappingURL=SupplierList.controller.js.map