sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/library"],function(e,t,s,i,r,n){"use strict";const o=n.ValueState;return e.extend("vendorportal.controller.SupplierList",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("SupplierList").attachPatternMatched(this._onRouteMatched,this);this._refreshInterval=null},onExit:function(){if(this._refreshInterval){clearInterval(this._refreshInterval)}},formatStatusState:function(e){switch(e){case"APPROVED":return o.Success;case"REJECTED":return o.Error;case"PENDING":return o.Warning;default:return o.None}},_onRouteMatched:function(){this._fetchSuppliers();if(this._refreshInterval){clearInterval(this._refreshInterval)}this._refreshInterval=setInterval(()=>{this._fetchSuppliers()},15e3)},_fetchSuppliers:function(){fetch(this.getURL()+"/odata/v4/supplier/getsuppliers").then(e=>{if(!e.ok){throw new Error("Network response was not ok")}return e.json()}).then(e=>{const s=Array.isArray(e.value)?e.value:[];let i=this.getView().getModel("supplierModel");if(i){i.setData({suppliers:s})}else{i=new t({suppliers:s});this.getView().setModel(i,"supplierModel")}i.refresh(true);this.byId("deleteModeButton").setVisible(s.length>0)}).catch(e=>{s.error("Error fetching suppliers: "+e.message)})},onClearFilters:function(){this.byId("filterName").setValue("");this.byId("filterCity").setValue("");this.byId("filterStatus").setSelectedKey("");this.onFilterSuppliers()},onFilterSuppliers:function(){const e=this.byId("supplierTable");const t=e.getBinding("items");const s=this.byId("filterName").getValue();const n=this.byId("filterCity").getValue();const o=this.byId("filterStatus").getSelectedKey();const l=[];if(s){l.push(new i("supplierName",r.Contains,s))}if(n){l.push(new i("mainAddress/city",r.Contains,n))}if(o){l.push(new i("status",r.EQ,o))}t.filter(l)},onSupplierPress:function(e){const t=e.getParameter("listItem");const s=t.getBindingContext("supplierModel").getProperty("supplierName");const i=this.getOwnerComponent().getRouter();i.navTo("SupplierDetail",{supplierId:s})},onDeleteMode:function(){const e=this.byId("supplierTable");e.setMode("MultiSelect");this.byId("deleteModeButton").setVisible(false);this.byId("confirmDeleteButton").setVisible(true);this.byId("cancelDeleteButton").setVisible(true)},onCancelDelete:function(){const e=this.byId("supplierTable");e.setMode("None");e.removeSelections(true);this.byId("deleteModeButton").setVisible(true);this.byId("confirmDeleteButton").setVisible(false);this.byId("cancelDeleteButton").setVisible(false)},onDeleteSelectedSuppliers:function(){const e=this.byId("supplierTable").getSelectedItems();if(e.length===0){s.warning("Please select at least one supplier to delete.");return}const t=`Are you sure you want to delete these ${e.length} supplier(s)?`;s.confirm(t,{title:"Confirm Deletion",onClose:t=>{if(t===s.Action.OK){this._performDeletion(e)}}})},_performDeletion:function(e){const t=this.getURL()+"/odata/v4/supplier/deletesuppliers";const i=e.map(e=>{const s=e.getBindingContext("supplierModel").getProperty("supplierName");return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({supplierName:s})})});Promise.all(i).then(e=>{const t=e.filter(e=>!e.ok);if(t.length>0){s.error(`${t.length} deletion(s) failed.`)}else{s.success(`${e.length} supplier(s) deleted successfully.`)}}).catch(e=>{s.error("An error occurred during deletion: "+e.message)}).finally(()=>{this.onCancelDelete();this._fetchSuppliers()})},onNavBack:function(){const e=sap.ui.core.routing.History.getInstance();const t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getOwnerComponent().getRouter().navTo("View1",{},true)}},getURL:function(){return sap.ui.require.toUrl("vendorportal")}})});
//# sourceMappingURL=SupplierList.controller.js.map